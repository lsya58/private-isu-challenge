# private-isu-challenge

PR TIMES学生インターン課題

## 環境
- 言語: PHP 8.3
- データベース: MySQL 8.4
- キャッシュ: memcached

## スコア履歴

### 初期スコア
- **スコア: 0**
- **success: 84, fail: 66**
- 日時: 2026-01-15
- 備考: 多数のタイムアウトが発生。

## 改善内容

### 1. 画像配信の改善
画像をDBに保存していたのを、ファイルシステムに保存するに変更しました。
DBだと、取得するのが重すぎたためです。

- スコア: 0→0 (でもpass: trueにはなった)
- PR: #1

まだタイムアウト多くてスコア0。もっと改善必要

### 2. N+1クエリ解消
投稿を表示するたびに大量のクエリが表示されていました。
対策としてユーザーとコメントをまとめて取得できるように変更しました。

- スコア: 0→2296
- PR: #2

### 3. インデックスの追加
クエリが遅かったために、comments.post_id, comments.user_id, posts.user_idにインデックス追加しました。

- スコア: 2296→2787
- PR: #3

### 4. 静的ファイルのキャッシュ設定
ページ表示の高速化を目的として、nginxの設定でCSS・JavaScript・画像ファイルに1日間のキャッシュを設定しています。

- スコア: 2787→2651 (効果なし)
- 設定ファイル: webapp/etc/nginx/conf.d/php.conf

### 5. created_atインデックス追加
ORDER BY created_at がボトルネックになって遅かったため、posts.created_at にインデックスを追加しました。

- スコア: 2787→3997(大幅に向上)

### 最終スコア
- **スコア: 3997**
- **success: 3394, fail: 0**
- 日時: 2026-01-16

## 総括
データベースのクエリ最適化が最も効果的でした。

特に効果があった改善：
1. **N+1クエリの解消** (0→2296点) - ループ内のクエリを一括取得に変更
2. **created_atインデックス** (2787→3997点) - ソート処理の高速化

学んだこと：
データベースのクエリ最適化が最重要で最も効果が出ることがわかりました。
インデックスの設計が性能に大きく影響を与えていることがわかりました。
静的ファイルキャッシュは今回の環境では効果薄いことが判明しました。

